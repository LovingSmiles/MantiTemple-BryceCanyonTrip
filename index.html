<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manti & Bryce Canyon Trip</title>
  <link rel="stylesheet" href="css/patriotic.css" />
</head>
<body>
  <nav>
    <a href="index.html" class="active">Home</a>
    <a href="directions-and-map.html">Directions & Map</a>
  </nav>

  <header>
    <h1>Manti Temple & Bryce Canyon Trip</h1>
    <p>Saturday, October 25, 2025 â€¢ Depart 4:30 AM</p>
  </header>

  <section>
    <h2>Manti Utah Temple Visit</h2>
    <p><strong>Session:</strong> 7:30 AM Proxy Endowment<br />
       <strong>Arrive by:</strong> 7:00 AM<br />
       <strong>Attendees:</strong> LovingSmiles & Josh</p>
    <img src="images/manti-temple.jpg" alt="Manti Utah Temple" />
  </section>

  <section>
    <h2>Next Stop â€“ Bryce Canyon National Park</h2>
    <p>After your temple session, enjoy a scenic drive to Bryce Canyon National Park for hiking, photos, and reflection.</p>
    <a href="directions-and-map.html" class="btn">View Directions & Map</a>
  </section>

  <section>
    <h2>Share Your Experience</h2>
    <p>You can share photos, short videos, and your thoughts from this trip below. Everything is safely stored in Firebase.</p>
    <input type="file" id="mediaUpload" accept="image/*,video/*"><br><br>
    <textarea id="comment" rows="4" cols="50" placeholder="Write your comment here..."></textarea><br><br>
    <button id="uploadBtn">Upload</button>
    <hr>
    <div id="mediaContainer"></div>
  </section>

  <footer>
    <p>Created by LovingSmiles â€¢ My Life Compass Solutions</p>
  </footer>

  <!-- Firebase SDK and Upload Script -->
  <script type="module">
    // Import Firebase modules from the CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-storage.js";

    // ðŸ”¹ Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBHwtE5GYOHr_WR4i9Yp38FsmDueyCrXl4",
      authDomain: "temple-trip-john-and-josh.firebaseapp.com",
      projectId: "temple-trip-john-and-josh",
      storageBucket: "temple-trip-john-and-josh.appspot.com",
      messagingSenderId: "870837548705",
      appId: "1:870837548705:web:8198b450d293c83760e2e0",
      measurementId: "G-7QGNL0LNR4"
    };

    // ðŸ”¹ Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    console.log("âœ… Firebase connected successfully!");

    // ---------- Upload + Comment Logic ----------
    const uploadBtn = document.getElementById("uploadBtn");
    const mediaUpload = document.getElementById("mediaUpload");
    const commentBox = document.getElementById("comment");
    const container = document.getElementById("mediaContainer");

    // Load posts from Firestore
    async function loadPosts() {
      container.innerHTML = "";
      const snap = await getDocs(collection(db, "posts"));
      snap.forEach(doc => {
        const data = doc.data();
        const card = document.createElement("div");
        card.style.background = "rgba(255,255,255,0.9)";
        card.style.padding = "15px";
        card.style.borderRadius = "8px";
        card.style.marginBottom = "15px";
        card.style.boxShadow = "0 0 6px rgba(0,0,0,0.2)";

        if (data.url) {
          const el = document.createElement(data.type.startsWith("video") ? "video" : "img");
          el.src = data.url;
          el.controls = data.type.startsWith("video");
          el.style.maxWidth = "100%";
          el.style.borderRadius = "6px";
          card.appendChild(el);
        }
        if (data.comment) {
          const p = document.createElement("p");
          p.textContent = data.comment;
          p.style.marginTop = "10px";
          card.appendChild(p);
        }
        container.appendChild(card);
      });
    }
    loadPosts();

    // Upload file + comment
    uploadBtn.addEventListener("click", async () => {
      const file = mediaUpload.files[0];
      const comment = commentBox.value.trim();
      if (!file && !comment) {
        alert("Please select a file or write a comment.");
        return;
      }

      // 10 MB cap
      if (file && file.size > 10 * 1024 * 1024) {
        alert("File too large! Max 10 MB allowed.");
        return;
      }

      let url = "";
      if (file) {
        const storageRef = ref(storage, "uploads/" + file.name);
        await uploadBytes(storageRef, file);
        url = await getDownloadURL(storageRef);
      }

      await addDoc(collection(db, "posts"), {
        type: file ? file.type : "text/plain",
        url,
        comment,
        createdAt: serverTimestamp()
      });

      commentBox.value = "";
      mediaUpload.value = "";
      alert("âœ… Uploaded successfully!");
      loadPosts();
    });
  </script>
</body>
</html>
</body>
</html>